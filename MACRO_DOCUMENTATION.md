# Документация по макросам MacroPad

## Оглавление
1. [Структура профиля](#структура-профиля)
2. [Типы кнопок](#типы-кнопок)
3. [Типы действий (Actions)](#типы-действий-actions)
4. [Паузы и задержки](#паузы-и-задержки)
5. [Нажатия клавиш](#нажатия-клавиш)
6. [Действия мыши](#действия-мыши)
7. [Повторения (Repeat)](#повторения-repeat)
8. [Цвета кнопок](#цвета-кнопок)
9. [Полные примеры](#полные-примеры)

---

## Структура профиля

Профиль - это JSON-файл, содержащий конфигурацию 12 кнопок MacroPad.

```json
{
  "name": "Название профиля",
  "buttons": [
    { /* Кнопка 0 */ },
    { /* Кнопка 1 */ },
    null,  // Кнопка 2 не настроена
    { /* Кнопка 3 */ },
    // ... всего 12 элементов (0-11)
  ]
}
```

**Важно:**
- Массив `buttons` должен содержать ровно 12 элементов
- `null` означает, что кнопка не используется
- Индексы 0-11 соответствуют физическим кнопкам на устройстве

---

## Типы кнопок

### Структура кнопки

```json
{
  "_id": "m_1234567890",
  "name": "Название кнопки",
  "type": "toggle",
  "loop": true,
  "actions": [ /* список действий */ ]
}
```

### Параметры кнопки

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| `_id` | string | Да | Уникальный идентификатор макроса |
| `name` | string | Да | Название макроса (отображается на экране) |
| `type` | string | Да | Тип активации: `once`, `hold`, `toggle` |
| `loop` | boolean | Нет | Зацикливание действий (по умолчанию: `false`) |
| `actions` | array | Да | Массив действий для выполнения |
| `colors` | object | Нет | Настройка цветов подсветки кнопки |

### Типы активации (`type`)

#### `"once"` - Однократное выполнение
Макрос выполняется один раз при нажатии кнопки.

```json
{
  "_id": "m_001",
  "name": "Save File",
  "type": "once",
  "actions": [
    { "type": "press", "keys": "Ctrl+S" }
  ]
}
```

#### `"hold"` - Удержание
Макрос выполняется, пока кнопка удерживается. Останавливается при отпускании.

```json
{
  "_id": "m_002",
  "name": "Sprint",
  "type": "hold",
  "loop": true,
  "actions": [
    { "type": "press", "keys": "Shift", "wait": 100 }
  ]
}
```

#### `"toggle"` - Переключение
Первое нажатие запускает макрос, второе - останавливает.

```json
{
  "_id": "m_003",
  "name": "Auto Clicker",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "mouse_click", "button": "left", "wait": 100 }
  ]
}
```

### Зацикливание (`loop`)

- `"loop": true` - после выполнения всех действий макрос переходит в режим SLEEP, ждёт финальный wait, затем начинается заново
- `"loop": false` или не указано - макрос выполняется один раз, затем останавливается и освобождает слот

**Важно:** 
- Макросы **без** `loop: true` выполняются один раз и завершаются
- Макросы **с** `loop: true` циклятся бесконечно до отключения toggle
- **Любой макрос** при нажатии встаёт в очередь, если слот выполнения занят
- Зацикливание работает только с типом `toggle` (для `once` не имеет смысла)

---

## Типы действий (Actions)

### 1. Нажатие клавиш - `press`

Имитирует нажатие и отпускание клавиш клавиатуры (полный цикл нажатия).

```json
{
  "type": "press",
  "keys": "F1",
  "wait": 1000
}
```

**Параметры:**
- `keys` (string, обязательный) - клавиша или комбинация клавиш
- `wait` (number, необязательный) - пауза после нажатия в миллисекундах
- `wait_random` (object, необязательный) - случайная пауза (см. раздел "Паузы")

### 1.1. Зажатие клавиш - `press_down`

Зажимает клавишу(и) без отпускания. Используется для точного контроля над нажатием клавиш.

```json
{
  "type": "press_down",
  "keys": "Shift",
  "wait": 100
}
```

**Параметры:**
- `keys` (string, обязательный) - клавиша или комбинация клавиш для зажатия
- `wait` (number, необязательный) - пауза после зажатия в миллисекундах
- `wait_random` (object, необязательный) - случайная пауза

**⚠️ Важно:** После `press_down` всегда должен следовать `press_up` для тех же клавиш, иначе они останутся зажатыми. При остановке макроса все клавиши автоматически отпускаются.

### 1.2. Отпускание клавиш - `press_up`

Отпускает ранее зажатые клавиши.

```json
{
  "type": "press_up",
  "keys": "Shift",
  "wait": 1000
}
```

**Параметры:**
- `keys` (string, обязательный) - клавиша или комбинация клавиш для отпускания
- `wait` (number, необязательный) - пауза после отпускания в миллисекундах
- `wait_random` (object, необязательный) - случайная пауза

**Пример использования `press_down` / `press_up`:**

```json
{
  "actions": [
    { "type": "press_down", "keys": "Shift", "wait": 100 },
    { "type": "press", "keys": "Space", "wait": 50 },
    { "type": "press_up", "keys": "Shift", "wait": 1000 }
  ]
}
```

Это обеспечивает точный контроль: Shift зажимается → ждем 100ms → нажимаем Space (пока Shift зажат) → ждем 50ms → отпускаем Shift → ждем 1000ms.

### 2. Ввод текста - `type`

Вводит текст как будто пользователь печатает на клавиатуре.

```json
{
  "type": "type",
  "text": "Hello World!",
  "wait": 500
}
```

**Параметры:**
- `text` (string, обязательный) - текст для ввода
- `wait` (number, необязательный) - пауза после ввода в миллисекундах
- `wait_random` (object, необязательный) - случайная пауза

### 3. Пауза - `wait`

Ожидание заданное количество миллисекунд.

```json
{
  "type": "wait",
  "ms": 5000
}
```

**Параметры:**
- `ms` (number, обязательный) - время ожидания в миллисекундах

### 4. Случайная пауза - `wait_random`

Ожидание случайное время в указанном диапазоне.

```json
{
  "type": "wait_random",
  "min": 1000,
  "max": 3000
}
```

**Параметры:**
- `min` (number, обязательный) - минимальное время в миллисекундах
- `max` (number, обязательный) - максимальное время в миллисекундах

### 5. Клик мыши - `mouse_click`

Имитирует нажатие кнопки мыши.

```json
{
  "type": "mouse_click",
  "button": "left",
  "wait": 100
}
```

**Параметры:**
- `button` (string, необязательный) - кнопка мыши: `"left"`, `"right"`, `"middle"` (по умолчанию: `"left"`)
- `wait` (number, необязательный) - пауза после клика в миллисекундах
- `wait_random` (object, необязательный) - случайная пауза

### 6. Движение мыши - `mouse_move`

Перемещает курсор мыши относительно текущей позиции.

```json
{
  "type": "mouse_move",
  "x": 10,
  "y": -5,
  "wait": 100
}
```

**Параметры:**
- `x` (number, обязательный) - смещение по горизонтали (+ вправо, - влево)
- `y` (number, обязательный) - смещение по вертикали (+ вниз, - вверх)
- `wait` (number, необязательный) - пауза после движения
- `wait_random` (object, необязательный) - случайная пауза

### 7. Прокрутка мыши - `mouse_scroll`

Прокручивает колесико мыши.

```json
{
  "type": "mouse_scroll",
  "amount": 5,
  "wait": 200
}
```

**Параметры:**
- `amount` (number, обязательный) - количество прокрутки (+ вверх, - вниз)
- `wait` (number, необязательный) - пауза после прокрутки
- `wait_random` (object, необязательный) - случайная пауза

### 8. Повторение - `repeat`

Повторяет группу действий указанное количество раз.

```json
{
  "type": "repeat",
  "count": 5,
  "actions": [
    { "type": "press", "keys": "Space", "wait": 100 },
    { "type": "wait", "ms": 500 }
  ]
}
```

**Параметры:**
- `count` (number, обязательный) - количество повторений
- `actions` (array, обязательный) - массив действий для повторения

---

## Паузы и задержки

### Встроенная пауза (`wait`)

Все действия кроме `wait` и `wait_random` поддерживают встроенный параметр `wait`:

```json
{ "type": "press", "keys": "F1", "wait": 1000 }
```

Это эквивалентно:

```json
{ "type": "press", "keys": "F1" },
{ "type": "wait", "ms": 1000 }
```

### Случайная пауза (`wait_random`)

Можно указать встроенную случайную паузу:

```json
{
  "type": "press",
  "keys": "F1",
  "wait_random": {
    "min": 500,
    "max": 1500
  }
}
```

Или отдельным действием:

```json
{
  "type": "wait_random",
  "min": 500,
  "max": 1500
}
```

### Примеры использования пауз

**Фиксированная пауза:**
```json
{ "type": "press", "keys": "F1", "wait": 1000 }
```

**Случайная пауза (более естественно):**
```json
{
  "type": "press",
  "keys": "F1",
  "wait_random": { "min": 800, "max": 1200 }
}
```

**Без паузы (следующее действие выполнится сразу):**
```json
{ "type": "press", "keys": "F1" }
```

---

## Нажатия клавиш

### Одиночные клавиши

```json
{ "type": "press", "keys": "A" }
{ "type": "press", "keys": "1" }
{ "type": "press", "keys": "F5" }
{ "type": "press", "keys": "Enter" }
{ "type": "press", "keys": "Space" }
```

### Комбинации клавиш

Используйте `+` для комбинаций:

```json
{ "type": "press", "keys": "Ctrl+C" }
{ "type": "press", "keys": "Shift+A" }
{ "type": "press", "keys": "Ctrl+Shift+Esc" }
{ "type": "press", "keys": "Alt+F4" }
{ "type": "press", "keys": "Win+1" }
```

### Поддерживаемые клавиши

**Буквы:** A-Z

**Цифры:** 0-9

**Функциональные клавиши:** F1-F12

**Модификаторы:**
- `Ctrl`, `Control` - Control
- `Shift` - Shift
- `Alt`, `Option` - Alt
- `Win`, `GUI`, `Windows`, `Cmd`, `Command` - клавиша Windows/Command

**Специальные клавиши:**
- `Enter`, `Return` - Enter
- `Escape`, `Esc` - Escape
- `Backspace` - Backspace
- `Tab` - Tab
- `Space`, `Spacebar` - Пробел
- `Delete` - Delete
- `Insert` - Insert
- `Home`, `End` - Home/End
- `PageUp`, `PageDown` - Page Up/Down

**Стрелки:**
- `Up`, `Down`, `Left`, `Right`
- `Up_Arrow`, `Down_Arrow`, `Left_Arrow`, `Right_Arrow`

**Знаки препинания:**
- `Minus` - минус
- `Equals` - равно
- `Left_Bracket`, `Right_Bracket` - скобки [ ]
- `Backslash` - обратная косая
- `Semicolon` - точка с запятой
- `Quote` - кавычка
- `Comma` - запятая
- `Period` - точка
- `Forward_Slash` - прямая косая

**Другие:**
- `Caps_Lock` - Caps Lock
- `Print_Screen` - Print Screen
- `Scroll_Lock` - Scroll Lock
- `Pause` - Pause

### Примеры комбинаций

```json
// Сохранить файл
{ "type": "press", "keys": "Ctrl+S" }

// Копировать
{ "type": "press", "keys": "Ctrl+C" }

// Вставить
{ "type": "press", "keys": "Ctrl+V" }

// Переключить окно
{ "type": "press", "keys": "Alt+Tab" }

// Переключиться на окно 1
{ "type": "press", "keys": "Win+1" }

// Открыть диспетчер задач
{ "type": "press", "keys": "Ctrl+Shift+Esc" }

// Закрыть окно
{ "type": "press", "keys": "Alt+F4" }
```

---

## Действия мыши

### Клик мыши

```json
// Левая кнопка (по умолчанию)
{ "type": "mouse_click", "button": "left" }

// Правая кнопка
{ "type": "mouse_click", "button": "right" }

// Средняя кнопка (колесико)
{ "type": "mouse_click", "button": "middle" }

// С паузой после клика
{ "type": "mouse_click", "button": "left", "wait": 500 }

// Со случайной паузой
{
  "type": "mouse_click",
  "button": "left",
  "wait_random": { "min": 100, "max": 300 }
}
```

### Движение мыши

```json
// Переместить вправо на 10 пикселей
{ "type": "mouse_move", "x": 10, "y": 0 }

// Переместить вверх на 20 пикселей
{ "type": "mouse_move", "x": 0, "y": -20 }

// Диагональное движение
{ "type": "mouse_move", "x": 15, "y": 10 }
```

### Прокрутка колесика

```json
// Прокрутить вверх
{ "type": "mouse_scroll", "amount": 5 }

// Прокрутить вниз
{ "type": "mouse_scroll", "amount": -5 }

// Быстрая прокрутка
{ "type": "mouse_scroll", "amount": 10 }
```

### Пример: Автокликер

```json
{
  "_id": "m_autoclicker",
  "name": "Auto Clicker",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "mouse_click", "button": "left", "wait": 100 }
  ]
}
```

### Пример: Двойной клик с паузой

```json
{
  "_id": "m_doubleclick",
  "name": "Double Click",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "mouse_click", "button": "left", "wait": 50 },
    { "type": "mouse_click", "button": "left", "wait": 5000 }
  ]
}
```

---

## Повторения (Repeat)

Действие `repeat` позволяет повторить группу действий несколько раз.

### Синтаксис

```json
{
  "type": "repeat",
  "count": 5,
  "actions": [
    /* действия для повторения */
  ]
}
```

### Примеры

**Нажать пробел 10 раз:**
```json
{
  "type": "repeat",
  "count": 10,
  "actions": [
    { "type": "press", "keys": "Space", "wait": 100 }
  ]
}
```

**Быстрые клики:**
```json
{
  "type": "repeat",
  "count": 5,
  "actions": [
    { "type": "mouse_click", "button": "left", "wait": 50 }
  ]
}
```

**Сложная последовательность:**
```json
{
  "type": "repeat",
  "count": 3,
  "actions": [
    { "type": "press", "keys": "1", "wait": 200 },
    { "type": "press", "keys": "2", "wait": 200 },
    { "type": "press", "keys": "3", "wait": 1000 }
  ]
}
```

**Вложенные повторения (поддерживаются):**
```json
{
  "type": "repeat",
  "count": 2,
  "actions": [
    {
      "type": "repeat",
      "count": 3,
      "actions": [
        { "type": "press", "keys": "A", "wait": 100 }
      ]
    },
    { "type": "wait", "ms": 500 }
  ]
}
```

---

## Цвета кнопок

Можно настроить цвет подсветки кнопки для разных состояний.

### Структура `colors`

```json
{
  "_id": "m_example",
  "name": "Example",
  "type": "toggle",
  "colors": {
    "ready": [0, 255, 0],      // Зеленый - готов к запуску
    "active": [255, 0, 0],     // Красный - выполняется
    "waiting": [255, 255, 0]   // Желтый - ожидание
  },
  "actions": [ /* ... */ ]
}
```

### Доступные состояния

- `ready` - кнопка в режиме SLEEP (зелёный) - ждёт таймер между циклами
- `loop` - кнопка ACTIVE (синий) - выполняет действия, владеет слотом
- `wait` - кнопка в режиме WAIT (жёлтый) - ожидание между действиями, держит слот
- `queued` - кнопка в очереди (фиолетовый) - проснулась, ждёт освобождения слота

**Примечание:** Состояния применяются автоматически в зависимости от того, что делает макрос.
- **SLEEP (ready/зелёный)**: Макрос включен, но ждёт таймер между итерациями loop
- **IN_QUEUE (queued/фиолетовый)**: Таймер истёк, но слот занят другим макросом
- **ACTIVE (loop/синий)**: Выполняет последовательность действий
- **WAIT (wait/жёлтый)**: Пауза между действиями внутри одной итерации

### Формат цвета

Цвет задается массивом RGB: `[R, G, B]`
- Значения от 0 до 255
- Например: `[255, 0, 0]` - красный, `[0, 255, 0]` - зеленый, `[0, 0, 255]` - синий

### Примеры цветов

```json
[255, 0, 0]     // Красный
[0, 255, 0]     // Зеленый
[0, 0, 255]     // Синий
[255, 255, 0]   // Желтый
[255, 0, 255]   // Пурпурный
[0, 255, 255]   // Голубой
[255, 255, 255] // Белый
[128, 0, 128]   // Фиолетовый
[255, 165, 0]   // Оранжевый
```

---

## Полные примеры

### Пример 1: Простое нажатие клавиши каждые 240 секунд

```json
{
  "_id": "m_1734350001",
  "name": "F5 Every 240s",
  "type": "toggle",
  "loop": true,
  "actions": [
    {
      "type": "press",
      "keys": "F5",
      "wait": 240000
    }
  ]
}
```

### Пример 2: Комбо-атака (F7-3-F6-3 с паузами)

```json
{
  "_id": "m_combo",
  "name": "Combo F7-3-F6-3",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "press", "keys": "F7", "wait": 250 },
    { "type": "press", "keys": "3", "wait": 250 },
    { "type": "press", "keys": "F6", "wait": 250 },
    { "type": "press", "keys": "3", "wait": 250 }
  ]
}
```

### Пример 3: Быстрое действие каждые 15 секунд

```json
{
  "_id": "m_quick",
  "name": "F4 Every 15s",
  "type": "toggle",
  "loop": true,
  "actions": [
    {
      "type": "press",
      "keys": "F4",
      "wait": 15000
    }
  ]
}
```

### Пример 4: Автокликер мыши с двойным кликом

```json
{
  "_id": "m_mouseloop",
  "name": "Mouse Click Loop",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "mouse_click", "button": "left", "wait": 1000 },
    { "type": "mouse_click", "button": "left", "wait": 10000 }
  ]
}
```

### Пример 5: Сложный фарм-макрос

```json
{
  "_id": "m_farm",
  "name": "Window 1 Farm",
  "type": "toggle",
  "loop": true,
  "actions": [
    { "type": "press", "keys": "Win+1", "wait": 3000 },
    { "type": "press", "keys": "F1", "wait": 1000 },
    { "type": "press", "keys": "F2", "wait": 1000 },
    { "type": "press", "keys": "F3", "wait": 1000 },
    { "type": "wait", "ms": 10000 },
    { "type": "press", "keys": "F4", "wait": 1000 },
    { "type": "press", "keys": "Win+3", "wait": 3000 },
    { "type": "wait", "ms": 300000 }
  ]
}
```

### Пример 6: Быстрая серия кликов с repeat

```json
{
  "_id": "m_rapidfire",
  "name": "Rapid Fire",
  "type": "once",
  "actions": [
    {
      "type": "repeat",
      "count": 10,
      "actions": [
        { "type": "mouse_click", "button": "left", "wait": 50 }
      ]
    }
  ]
}
```

### Пример 7: Макрос с случайными паузами (более естественный)

```json
{
  "_id": "m_natural",
  "name": "Natural Farming",
  "type": "toggle",
  "loop": true,
  "actions": [
    {
      "type": "press",
      "keys": "F1",
      "wait_random": { "min": 900, "max": 1100 }
    },
    {
      "type": "mouse_click",
      "button": "left",
      "wait_random": { "min": 2000, "max": 3000 }
    },
    {
      "type": "press",
      "keys": "Space",
      "wait_random": { "min": 5000, "max": 7000 }
    }
  ]
}
```

### Пример 8: Макрос с цветами

```json
{
  "_id": "m_colored",
  "name": "Colored Macro",
  "type": "toggle",
  "loop": true,
  "colors": {
    "ready": [0, 255, 0],
    "active": [255, 0, 0],
    "waiting": [255, 255, 0]
  },
  "actions": [
    { "type": "press", "keys": "F1", "wait": 5000 }
  ]
}
```

### Пример 9: Полный профиль

```json
{
  "name": "Gaming Profile",
  "buttons": [
    {
      "_id": "m_001",
      "name": "Combo Attack",
      "type": "toggle",
      "loop": true,
      "actions": [
        { "type": "press", "keys": "F7", "wait": 250 },
        { "type": "press", "keys": "3", "wait": 250 },
        { "type": "press", "keys": "F6", "wait": 250 },
        { "type": "press", "keys": "3", "wait": 250 }
      ]
    },
    {
      "_id": "m_002",
      "name": "Quick Action",
      "type": "toggle",
      "loop": true,
      "actions": [
        { "type": "press", "keys": "F4", "wait": 15000 }
      ]
    },
    {
      "_id": "m_003",
      "name": "Long Timer",
      "type": "toggle",
      "loop": true,
      "actions": [
        { "type": "press", "keys": "F8", "wait": 240000 }
      ]
    },
    {
      "_id": "m_004",
      "name": "Auto Clicker",
      "type": "toggle",
      "loop": true,
      "actions": [
        { "type": "mouse_click", "button": "left", "wait": 1000 },
        { "type": "mouse_click", "button": "left", "wait": 10000 }
      ]
    },
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null
  ]
}
```

---

## Советы и лучшие практики

### Время ожидания

- **Короткие паузы (50-300 мс):** для быстрых комбо
- **Средние паузы (1-5 секунд):** для обычных действий
- **Длинные паузы (10+ секунд):** для ожидания загрузки/кулдауна

### Использование loop

- Для бесконечных макросов (фарм, автокликер) используйте `"loop": true` с типом `toggle`
- Для однократных действий используйте `"type": "once"` без `loop`

### Случайные паузы

Используйте `wait_random` для более естественного поведения:
```json
"wait_random": { "min": 900, "max": 1100 }
```
вместо фиксированной паузы `"wait": 1000`

### Комбинации клавиш

- Модификаторы пишутся первыми: `"Ctrl+C"`, `"Shift+Alt+F1"`
- Регистр не важен: `"CTRL+C"` = `"ctrl+c"` = `"Ctrl+C"`
- Используйте `Win` для Windows, `Cmd` для Mac

### Тестирование

1. Начните с простого макроса
2. Протестируйте каждое действие
3. Постепенно добавляйте сложность
4. Используйте `"type": "once"` для отладки перед переключением на `toggle`

---

## Временные единицы

**Важно:** Все паузы указываются в **миллисекундах** (мс).

- 1 секунда = 1000 мс
- 5 секунд = 5000 мс
- 15 секунд = 15000 мс
- 1 минута = 60000 мс
- 4 минуты = 240000 мс
- 5 минут = 300000 мс

### Калькулятор времени

```
секунды → миллисекунды: умножить на 1000
минуты → миллисекунды: умножить на 60000

Примеры:
0.1 секунды = 100 мс
0.25 секунды = 250 мс
0.5 секунды = 500 мс
1 секунда = 1000 мс
2 секунды = 2000 мс
10 секунд = 10000 мс
30 секунд = 30000 мс
1 минута = 60000 мс
2 минуты = 120000 мс
5 минут = 300000 мс
```
